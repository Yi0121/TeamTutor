# TeamTutor智慧虛擬課堂建置方案—以多代理人與RAG技術建構適性化合作學習環境

## 專案名稱
「TeamTutor智慧虛擬課堂建置方案—以多代理人與RAG技術建構適性化合作學習環境」採購專案 。

## 專案說明
近年來，生成式AI與大型語言模型（LLMs）蓬勃發展，AI驅動之教育代理人已成為提升學習成效之重要工具。惟現行數位學習工具仍存在限制，如缺乏同儕互動或難以確保有效學習團隊 。本專案透過多代理人系統（MAS）結合大型語言模型，提供創新解決方案 。

本專案旨在建構「TeamTutor」智慧虛擬課堂，整合以下核心技術：
* **多代理人虛擬課堂核心引擎**：以 LangChain/LangGraph 為基礎，透過 Agent Orchestrator 協調多角色（虛擬學伴、教師）對話，實現三人或多人討論模式 。
* **MCP 與 Agentic RAG 動態對話策略**：導入 Model Context Protocol (MCP) 整合外部工具（如 GeoGebra、網頁搜尋、程式碼執行），並透過 Agentic RAG 自主判斷檢索策略 。
* **RAG 學科知識庫**：建置向量資料庫與檢索增強生成技術，降低 AI 幻覺，確保內容正確性 。
* **視覺化情境設定平臺**：提供拖曳式 Workflow 編輯器，降低教師設計 AI 角色與互動流程的門檻 。
* **學習歷程分析與儀表板**：以 Event Sourcing 記錄互動事件，提供視覺化數據儀表板 。
* **數據安全與權限管理**：採用四級權限架構與 RBAC 模型，符合資通安全責任等級中級防護基準 。

**本系統提供雙軌應用模式：**
1.  **學生合作學習模式**：提供「理想學習團隊」，透過與 AI 學伴互動培養協作與批判思考。教師可設計認知衝突或「以教促學」策略 。
2.  **師資生模擬實習模式**：提供虛擬實習場域，模擬不同特質的 AI 學生，供師資生練習教學策略，並支援歷程重播與自動生成教學分析報告 。

## 專案目標
* 建構多代理人虛擬課堂核心引擎，模擬多元且高效之學習小組 。
* 導入 MCP 與 Agentic RAG 以動態調控對話策略，支援外部工具串接 。
* 建置 RAG 學科知識庫以確保回應之正確性，降低 AI 幻覺 。
* 開發友善之視覺化情境設定介面，大幅降低使用門檻 。
* 建構學習歷程分析與儀表板功能，保留歷程供省思並提供數據分析 。
* 確保技術可靠性與數據安全 。

## 專案需求說明

### 一、多代理人虛擬課堂核心引擎

#### （一）多代理人對話引擎架構
* **技術框架**：以 LangChain 或 LangGraph 為基礎 。
* **核心組件**：
    * `Agent Orchestrator`：管理生命週期與對話排程 。
    * `State Manager`：維護上下文與共享記憶體 。
    * `Message Router`：路由分配訊息 。
    * `Tool Executor`：呼叫外部工具 。
* **模型支援**：支援多個 LLM API 同時運行（OpenAI GPT-4o, Claude 3.5 Sonnet, Gemini 1.5 Pro 等）。
* **介面設計**：
    * 左側：參與者面板（顯示角色、狀態）。
    * 中央：聊天室介面（支援 Markdown、LaTeX、程式碼高亮）。
    * 右側：情境資訊面板（學習目標、統計）。
    * 底部：輸入區域（文字、檔案、語音）。

#### （二）AI代理人角色設定機制
* **參數管理**：JSON 格式儲存，包含 `base_model`, `system_prompt`, `knowledge_level` (1-10), `communication_style`, `rag_knowledge_base_ids`, `temperature` 等 。
* **設定頁面**：
    * 基本資訊：頭像（支援 DALL-E 生成）、名稱、說明 。
    * 進階設定：LLM 模型選擇、System Prompt 編輯、風格滑桿、知識庫關聯、建議問題設定 。
    * 功能：預覽測試、儲存為模板 。

#### （三）多角色對話協調機制
* **對話狀態機**：包含 WAITING_USER, AGENT_THINKING, AGENT_RESPONDING, TOOL_EXECUTING 等狀態 。
* **回應邏輯**：
    * 特定指名優先回應（如「老師請問...」）。
    * 無指名則依 `relevance_score` 排序 。
    * 支援規則設定（如「學生發言後教師必須回應」）。
    * 確保三人對話（Trialogue）的平衡性，避免 AI 間過度對話 。

### 二、MCP與Agentic RAG模組

#### （一）Model Context Protocol（MCP）整合
* **架構**：MCP Server（工具管理）、MCP Client（路由與呼叫）、Tool Registry（註冊表）。
* **整合工具**：
    1.  **GeoGebra 數學工具**：函數/幾何繪圖、代數運算，圖形需嵌入對話 。
    2.  **網頁搜尋工具**：整合搜尋引擎 API，提供來源網址 。
    3.  **程式碼執行工具**：安全沙箱（Docker）執行 Python，支援圖表輸出 。
    4.  **計算機工具**：數值運算 。
* **管理頁面**：工具卡片清單、參數設定、日誌查看、新增自訂工具 。

#### （二）Agentic RAG實作
* **流程架構**（LangGraph 實作）：
    * `Query Analyzer`：分析是否需檢索，優化查詢 。
    * `Retrieval Planner`：決定檢索策略（知識庫選擇、參數）。
    * `Result Evaluator`：評估結果品質，必要時觸發補充檢索 。
    * `Response Synthesizer`：整合生成回應 。
* **對話策略引擎**：根據目標進度、學生理解度、情緒氛圍、時間因素，動態調整回應策略（如從詳細解說轉為提問引導）。

### 三、RAG知識庫管理模組

#### （一）向量資料庫建置
* **資料庫選型**：Chroma, Milvus, Pinecone 等或 PostgreSQL (pgvector) 。
* **處理 Pipeline**：
    * `Document Loader`：支援 PDF, DOCX, HTML 等 。
    * `Text Splitter`：遞迴切分，建議 chunk_size 500-1000 。
    * `Embedding Generator`：使用 OpenAI text-embedding-3-small 或同級模型 。
    * `Vector Store`：儲存向量與 metadata 。
* **管理頁面**：文件管理（上傳/處理）、設定（Chunk 參數/權限）、檢索測試（驗證品質）。

#### （二）知識庫版本管理
* **機制**：每次變更產生版本記錄（Git-like 或 Time Travel 概念）。
* **功能**：檢視版本歷史、還原至特定版本 。

### 四、視覺化情境設定平臺

#### （一）Agentic Workflow視覺化編輯器
* **技術**：React + react-flow 。
* **節點類型**：Agent Node, Trigger Node, Condition Node, Action Node, End Node 。
* **介面**：元件面板（拖曳）、畫布區域（連線/編輯）、屬性面板（動態表單）、小地圖 。

#### （二）情境模板系統
* **預載模板**：三人討論、蘇格拉底對話、以教促學、辯論、模擬課堂 。
* **功能**：模板瀏覽（卡片牆）、預覽詳情、基於模板建立新專案 。

### 五、學習歷程分析與儀表板

#### （一）學習歷程紀錄系統
* **模式**：Event Sourcing，記錄 MESSAGE_SENT, TOOL_INVOKED, RAG_RETRIEVED 等事件 。
* **介面**：歷程列表、歷程回放（時間軸/播放控制）、標註功能（教師評語）、報告匯出 。

#### （二）學習儀表板
* **指標**：使用量 (Usage)、參與度 (Engagement)、學習成效 (Learning metrics) 。
* **介面**：可拖曳 Widget（班級概況、排行、異常警示）、自訂版面、圖表匯出 。

#### （三）師資生教學省思模組
* **自動報告**：LLM 分析教學策略、互動比例、應對方式 。
* **省思日誌**：結構化表單（目標/過程/自評/反思）。
* **指導回饋**：教授線上評語通知 。

### 六、權限管理與系統管理

#### （一）帳號與權限管理
* **架構**：RBAC 四級權限（系統總管、學校管理、教師、學生）。
* **功能**：組織架構管理、批次匯入/匯出、代理人指派 。

#### （二）使用量監測與成本控管
* **追蹤**：記錄 user_id, provider, tokens, cost 。
* **控管**：設定配額（日/月），達標通知與停用權限 。
* **介面**：費用總覽、多維度分析（依時間/使用者/模型/代理人）。

#### （三）嵌入與整合功能
* **方式**：
    1.  iframe 嵌入 。
    2.  聊天氣泡（JavaScript Widget）。
* **安全**：CORS、Referrer 白名單 。
* **介面**：外觀設定、網域設定、程式碼生成 。